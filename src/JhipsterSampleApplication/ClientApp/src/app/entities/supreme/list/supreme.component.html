<div style="height: calc(100vh - 174px); display: flex; flex-direction: column">
  <h2 class="d-flex align-items-center gap-2">
    <span>Supreme...</span>
    <lib-query-input
      [(query)]="currentQuery"
      (queryChange)="onQueryChange($event)"
      placeholder="click search icon for widget or click to edit"
      [spec]="spec"
      [namedQueryDomain]="'supreme'"
    ></lib-query-input>

    <div class="d-flex ms-auto">
      <button
        class="btn btn-info me-2"
        (click)="refreshData()"
        [title]="(dataLoader.loading$ | async) ? 'Refresh (cancel current and restart)' : 'Refresh List'"
      >
        <fa-icon icon="sync" [spin]="dataLoader.loading$ | async"></fa-icon>
        <span>Refresh List</span>
      </button>

      <div class="d-flex align-items-center ms-2">
        <select class="form-select w-auto" [(ngModel)]="viewName" (ngModelChange)="onViewChange($event)">
          <option [ngValue]="null">Select a view</option>
          @for (v of views; track v) {
            <option [ngValue]="v.value">
              {{ v.label }}
            </option>
          }
        </select>
        @if (viewName) {
          <button type="button" class="btn btn-link p-0 ms-1" aria-label="Clear selected view" (click)="onViewChange(null)">
            <fa-icon icon="times"></fa-icon>
          </button>
        }
      </div>

      <input
        #globalFilterInput
        pInputText
        type="text"
        class="p-inputtext-sm ms-2 global-filter-input"
        placeholder="filter"
        (input)="superTable.filterGlobal(globalFilterInput.value)"
      />

      <div class="form-check ms-2" style="font-size: 1rem; display: flex; align-items: center; font-weight: 400">
        <input id="showRowNumbers" type="checkbox" class="form-check-input" [(ngModel)]="showRowNumbers" />
        <label for="showRowNumbers" class="form-check-label">&nbsp;Show row numbers</label>
      </div>
    </div>
  </h2>

  @if (checkboxSelectedRows.length > 0) {
    <div class="chip-bar d-flex align-items-center gap-2 mb-2">
      @if (checkboxSelectedRows.length <= 2) {
        <ng-container *ngFor="let row of chipSelectedRows; trackBy: trackById">
          <p-chip
            [label]="(row.name || '')"
            [removable]="true"
            (onRemove)="onRemoveChip(row)"
            (mouseenter)="onChipMouseEnter($event, row)"
          ></p-chip>
        </ng-container>
      }
      @if (checkboxSelectedRows.length >= 3) {
        <p-chip
          [label]="checkboxSelectedRows.length + ' selected'"
          [removable]="true"
          (onRemove)="onRemoveCountChip()"
          (mouseenter)="onCountChipMouseEnter($event)"
        ></p-chip>
      }
    </div>
  }

  <p-menu #chipMenu [popup]="true" [model]="chipMenuModel"></p-menu>

  <div class="table-responsive" style="flex: 1; min-height: 0">
    <super-table
      #superTable
      [dataLoader]="dataLoader"
      [columns]="columns"
      [highlightPattern]="currentQuery"
      [mode]="viewMode"
      [groups]="groups"
      [groupQuery]="groupQuery.bind(this)"
      [superTableParent]="null"
      [resizableColumns]="true"
      [scrollable]="true"
      scrollHeight="flex"
      [showRowNumbers]="showRowNumbers"
      [globalFilterFields]="globalFilterFields"
      [selectionMode]="selectionMode"
      [(selection)]="selection"
      (selectionChange)="onCheckboxChange()"
      [contextMenu]="contextMenu"
      (onContextMenuSelect)="onContextMenuSelect($event)"
      (contextMenuSelectionChange)="onContextMenuSelect($event)"
      (rowExpand)="onRowExpand($event)"
      (rowCollapse)="onRowCollapse($event)"
      [expandedRowTemplate]="expandedRow"
    ></super-table>
  </div>

  <ng-template #expandedRow let-rowData>
    <ng-container *ngIf="iframeSafeSrcById[rowData.id]; else waiting">
      <iframe
        [src]="iframeSafeSrcById[rowData.id]"
        style="width: 100%; height: 288px; border: 0"
        (load)="onExpandedIframeLoad(rowData.id, $event)"
        loading="lazy"
      ></iframe>
    </ng-container>
    <ng-template #waiting>
      <div class="text-muted" style="padding: 0.5rem 0">Loadingâ€¦</div>
    </ng-template>
  </ng-template>

  <p-contextMenu #contextMenu [model]="menuItems" (onShow)="onMenuShow()"></p-contextMenu>
</div>