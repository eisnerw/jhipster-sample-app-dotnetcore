<div style="height: calc(100vh - 174px); display: flex; flex-direction: column">
  <h2 id="page-heading" data-cy="BirthdayHeading" class="d-flex align-items-center gap-2">
    <span>Birthdays...</span>
    <lib-query-input
      [(query)]="currentQuery"
      (queryChange)="onQueryChange($event)"
      placeholder="click search icon for widget or click to edit"
      [spec]="spec"
    >
    </lib-query-input>
    <div class="d-flex ms-auto">
      <button
        class="btn btn-info me-2"
        (click)="refreshData()"
        [title]="(dataLoader.loading$ | async) ? 'Refresh (cancel current and restart)' : 'Refresh List'"
      >
        <fa-icon icon="sync" [spin]="dataLoader.loading$ | async"></fa-icon>
        <span>Refresh List</span>
      </button>

      <div class="d-flex align-items-center ms-2">
        <select class="form-select w-auto" [(ngModel)]="viewName" (ngModelChange)="onViewChange($event)">
          <option [ngValue]="null">Select a view</option>
          @for (v of views; track v) {
            <option [ngValue]="v.value">
              {{ v.label }}
            </option>
          }
        </select>
        @if (viewName) {
          <button type="button" class="btn btn-link p-0 ms-1" aria-label="Clear selected view" (click)="onViewChange(null)">
            <fa-icon icon="times"></fa-icon>
          </button>
        }
      </div>

      <input
        #globalFilterInput
        pInputText
        type="text"
        class="p-inputtext-sm ms-2 global-filter-input"
        placeholder="filter"
        (input)="superTable.filterGlobal(globalFilterInput.value)"
      />

      <div class="form-check ms-2" style="font-size: 1rem; display: flex; align-items: center; font-weight: 400">
        <input id="showRowNumbers" type="checkbox" class="form-check-input" [(ngModel)]="showRowNumbers" />
        <label for="showRowNumbers" class="form-check-label">&nbsp;Show row numbers</label>
      </div>

      <button
        id="jh-create-entity"
        data-cy="entityCreateButton"
        class="btn btn-primary jh-create-entity create-birthday ms-2"
        [routerLink]="['/birthday/new']"
      >
        <fa-icon icon="plus"></fa-icon>
        <span>Create a new Birthday</span>
      </button>
    </div>
  </h2>

  <jhi-alert-error></jhi-alert-error>
  <jhi-alert></jhi-alert>

  <!-- Chip Bar: visible only when any rows are selected via checkboxes -->
  @if (checkboxSelectedRows.length > 0) {
    <div class="chip-bar d-flex align-items-center gap-2 mb-2">
      <!-- 1-2 selections: render individual chips with names -->
      @if (checkboxSelectedRows.length <= 2) {
        <ng-container *ngFor="let row of chipSelectedRows; trackBy: trackById">
          <p-chip
            [label]="(row.fname || '') + ' ' + (row.lname || '')"
            [removable]="true"
            (onRemove)="onRemoveChip(row)"
            (mouseenter)="onChipMouseEnter($event, row)"
          ></p-chip>
        </ng-container>
      }
      <!-- 3+ selections: render a single chip with count -->
      @if (checkboxSelectedRows.length >= 3) {
        <p-chip
          [label]="checkboxSelectedRows.length + ' selected'"
          [removable]="true"
          (onRemove)="onRemoveCountChip()"
          (mouseenter)="onCountChipMouseEnter($event)"
        ></p-chip>
      }
    </div>
  }

  <!-- Hover menu used for chip actions -->
  <p-menu #chipMenu [popup]="true" [model]="chipMenuModel"></p-menu>

  <div class="table-responsive" style="flex: 1; min-height: 0">
    <super-table
      #superTable
      [dataLoader]="dataLoader"
      [columns]="columns"
      [mode]="viewMode"
      [groups]="groups"
      [groupQuery]="groupQuery.bind(this)"
      [superTableParent]="null"
      [resizableColumns]="true"
      [scrollable]="true"
      scrollHeight="flex"
      [showRowNumbers]="showRowNumbers"
      [globalFilterFields]="globalFilterFields"
      [selectionMode]="selectionMode"
      [(selection)]="selection"
      (selectionChange)="onCheckboxChange()"
      [contextMenu]="contextMenu"
      (onContextMenuSelect)="onContextMenuSelect($event)"
      (contextMenuSelectionChange)="onContextMenuSelect($event)"
      (onSort)="onSort($event)"
      [expandedRowTemplate]="expandedRow"
    ></super-table>
  </div>

  <ng-template #expandedRow let-rowData>
    <tr>
      <td [attr.colspan]="columns.length + 1">
        <iframe
          [src]="sanitizer.bypassSecurityTrustResourceUrl('/api/birthdays/html/' + rowData.id)"
          style="width: 100%; height: 288px; border: 0"
          loading="lazy"
        ></iframe>
      </td>
    </tr>
  </ng-template>

  <p-contextMenu #contextMenu [model]="menuItems" (onShow)="onMenuShow()"></p-contextMenu>

  <p-confirmDialog></p-confirmDialog>

  <p-dialog [(visible)]="showCategorizeDialog" [modal]="true" [header]="'Categorize (' + rowsToCategorizeCount + ')'" [style]="{width: '32rem'}">
    <div class="mb-2">
      <label class="form-label">New category</label>
      <div class="input-group">
        <input pInputText type="text" [(ngModel)]="newCategoryText" (input)="filterCategoriesList()" placeholder="Type to filter or add" />
        <span class="input-group-text">
          <p-checkbox [(ngModel)]="newCategoryChecked" binary="true"></p-checkbox>
        </span>
      </div>
    </div>
    <div class="mb-2">
      <label class="form-label">Existing categories</label>
      <div style="max-height: 16rem; overflow: auto">
        <div class="form-check" *ngFor="let cat of filteredCategories">
          <p-checkbox [binary]="true" [ngModel]="categoryState[cat] !== 'unchecked'" (onChange)="toggleCategory(cat)"></p-checkbox>
          <span class="ms-2">{{ cat }}</span>
          <span *ngIf="categoryState[cat] === 'indeterminate'" class="text-muted ms-1">(some)</span>
        </div>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <button type="button" pButton class="p-button-text" (click)="cancelCategorize()">Cancel</button>
      <button type="button" pButton label="Apply" (click)="applyCategorize()" [disabled]="!hasCategorizeChanges()"></button>
    </ng-template>
  </p-dialog>

  <p-dialog [(visible)]="bDisplaySearchDialog" [modal]="true" header="Search Birthdays">
    <!-- Search dialog content -->
  </p-dialog>
</div>
